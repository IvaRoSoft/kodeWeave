function updatePreview(){$(".preview-frame").empty();var e=document.createElement("iframe");e.setAttribute("id","preview"),e.setAttribute("sandbox","allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),document.querySelector(".preview-frame").appendChild(e);var t=document.getElementById("preview"),r=t.contentDocument||t.contentWindow.document,s=openHTML.getValue()+closeHTML.getValue()+$("[data-action=library-code]").val()+'<link rel="stylesheet" href="../editor/libraries/font-awesome/font-awesome.css"><link rel="stylesheet" href="../editor/libraries/font-awesome/macset.css">\n<script src="    ../editor/lib/screenlog.js"><\/script>';r.open();var o=$("#html-preprocessor option:selected").val(),i=$("#js-preprocessor   option:selected").val();if(cssPreProcessor(),"none"==i)jsContent="<script>screenLog.init({ autoScroll: false });<\/script><script>"+jsEditor.getValue()+"<\/script>";else if("coffeescript"==i)jsContent="<script>screenLog.init({ autoScroll: false });<\/script><script>"+CoffeeScript.compile(jsEditor.getValue(),{bare:!0})+"<\/script>";else if("typescript"==i)jsContent='<script>screenLog.init({ autoScroll: false });<\/script><script type="text/typescript">'+jsEditor.getValue()+"<\/script>\n  <script type=\"text/javascript\" src='../editor/lib/typescript.min.js'><\/script>\n  <script type=\"text/javascript\" src='../editor/lib/typescript.compile.min.js'><\/script>";else if("babel"==i){var d=Babel.transform(jsEditor.getValue(),{presets:["latest","stage-2","react"]});jsContent="<script>screenLog.init({ autoScroll: false });\n\n"+d.code+"<\/script>"}if("none"==o)htmlContent=s+"<style id='b8c770cc'>"+cssContent+"</style>"+closeRefs.getValue()+"\n"+htmlEditor.getValue()+"\n\n    "+jsContent+closeFinal.getValue(),r.write(htmlContent);else if("jade"==o){var a={pretty:!0},n=jade.render(htmlEditor.getValue(),a);htmlContent=s+"<style id='b8c770cc'>"+cssContent+"</style>"+closeRefs.getValue()+"\n"+n+jsContent+closeFinal.getValue(),r.write(htmlContent)}r.close()}function loadgist(e){$.ajax({url:"https://api.github.com/gists/"+e,type:"GET",dataType:"jsonp",jsonp:"callback"}).success(function(e){var t=e.data.files["index.html"],r=e.data.files["index.jade"],s=e.data.files["index.css"],o=e.data.files["index.styl"],i=e.data.files["index.less"],d=e.data.files["index.js"],a=e.data.files["index.coffee"],n=e.data.files["index.ts"],l=e.data.files["index.jsx"],c=e.data.files["README.md"],u=e.data.files["libraries.json"].content,p=JSON.parse(u);$.each(p,function(e,t){$(".ldd-submenu #"+e).prop("checked",t).trigger("keyup")}),$("#jquery").trigger("keyup"),c&&mdEditor.setValue(c.content),c||$("[data-target=mdEditor]").addClass("hide"),t&&(htmlEditor.setValue(t.content),$("#html-preprocessor").val("none").change()),r&&(htmlEditor.setValue(r.content),$("#html-preprocessor").val("jade").change(),$("[data-target=htmlEditor]").text("Pug")),t||r||$("[data-target=htmlEditor]").addClass("hide"),s&&(cssEditor.setValue(s.content),$("#css-preprocessor").val("none").change()),o&&(cssEditor.setValue(o.content),$("#css-preprocessor").val("stylus").change(),$(window).on("load resize",function(){$(this).width()<=420?$("[data-target=cssEditor]").text("Styl"):$("[data-target=cssEditor]").text("Stylus")})),i&&(cssEditor.setValue(i.content),$("#css-preprocessor").val("less").change(),$("[data-target=cssEditor]").text("LESS")),s||o||i||$("[data-target=cssEditor]").addClass("hide"),d&&(jsEditor.setValue(d.content),$("#js-preprocessor").val("none").change(),jsContent="<script>"+jsEditor.getValue()+"<\/script>",$(window).on("load resize",function(){$(this).width()<=420?$("[data-target=jsEditor]").text("JS"):$("[data-target=jsEditor]").text("JavaScript")})),a&&(jsEditor.setValue(a.content),$("#js-preprocessor").val("coffeescript").change(),jsContent="<script>"+CoffeeScript.compile(jsEditor.getValue(),{bare:!0})+"<\/script>",$(window).on("load resize",function(){$(this).width()<=420?$("[data-target=jsEditor]").text("Coffee"):$("[data-target=jsEditor]").text("CoffeeScript")})),n&&(jsEditor.setValue(n.content),$("#js-preprocessor").val("typescript").change(),jsContent="<script type='text/typescript'>"+jsEditor.getValue()+"<\/script>",$(window).on("load resize",function(){$(this).width()<=420?$("[data-target=jsEditor]").text("TS"):$("[data-target=jsEditor]").text("TypeScript")})),l&&($("#js-preprocessor").val("babel").trigger("change"),jsEditor.setValue(l.content),$(window).on("load resize",function(){$("[data-target=jsEditor]").text("Babel")})),d||a||n||l||jsEditor.setValue(""),$(".preloader").remove(),setTimeout(function(){$(".mainmenu a:not(.hide):first").trigger("click")},500)}).error(function(e){$(".preloader").remove(),console.warn("Error: Could not load weave!",e),alertify.error("Error: Could not load weave!")})}function cssPreProcessor(e){if("none"==(e=$("#css-preprocessor  option:selected").val()))cssContent=cssEditor.getValue();else if("stylus"==e){var t=cssEditor.getValue();stylus(t).render(function(e,t){null!==e?console.error("something went wrong"):cssContent=t})}else"less"==e&&less.render(cssEditor.getValue(),function(e,t){yourCSS=t.css})}var site=window.location;"http://"===(site=site.toString()).substring(0,7)&&(window.location.href="https://"+site.substring(7,site.length)),$(".libsources").each(function(){$(this).val(this.value.replace(/libraries/g,"../editor/libraries"))});var openHTML=CodeMirror(document.querySelector("#openHTML"),{mode:"text/html",value:"<!DOCTYPE html><html><head>"}),closeHTML=CodeMirror(document.querySelector("#closeHTML"),{mode:"text/html",value:'<meta charset="utf-8"><meta name="viewport" content="initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=9" />\n'}),closeRefs=CodeMirror(document.querySelector("#closeRefs"),{mode:"text/html",value:"  </head>\n  <body>\n"}),closeFinal=CodeMirror(document.querySelector("#closeFinal"),{mode:"text/html",value:"\n  </body>\n</html>"}),str=window.location.href,url=window.location.hash,hash=window.location.hash,htmlContent,cssContent,jsContent,cssSelected;if(document.querySelector("[data-action=rerun]").onclick=function(e){e.preventDefault(),updatePreview()},url){if(url.indexOf("?")>-1){if($("[data-target=mdEditor]").addClass("hide"),$("[data-target=htmlEditor]").addClass("hide"),$("[data-target=cssEditor]").addClass("hide"),$("[data-target=jsEditor]").addClass("hide"),$("[data-target=preview]").addClass("hide"),url.indexOf("md")>-1&&($("[data-target=mdEditor]").removeClass("hide"),mdeditor.checked=!0),url.indexOf("html")>-1&&($("[data-target=htmlEditor]").removeClass("hide"),htmleditor.checked=!0),url.indexOf("css")>-1&&($("[data-target=cssEditor]").removeClass("hide"),csseditor.checked=!0),url.indexOf("js")>-1&&($("[data-target=jsEditor]").removeClass("hide"),jseditor.checked=!0),url.indexOf("result")>-1&&($("[data-target=preview]").removeClass("hide"),previeweditor.checked=!0),url.indexOf("edit")>-1){var htmlEditor=CodeMirror(document.getElementById("htmlEditor"),{mode:"text/html",tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],value:""});Inlet(htmlEditor);var cssEditor=CodeMirror(document.getElementById("cssEditor"),{mode:"text/css",tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]});Inlet(cssEditor);var jsEditor=CodeMirror(document.getElementById("jsEditor"),{tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,foldGutter:!0,dragDrop:!0,lint:!1,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],mode:{name:"javascript",globalVars:!1}});Inlet(jsEditor);var mdEditor=CodeMirror(document.getElementById("mdEditor"),{mode:"text/x-markdown",theme:"default",tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,gutters:["CodeMirror-linenumbers"]});Inlet(mdEditor),htmlEditor.on("change",function(){updatePreview()}),cssEditor.on("change",function(){cssPreProcessor(),$("#preview").contents().find("#b8c770cc").html(cssContent),setTimeout(function(){cssEditor.setOption("paletteHints","true")},300)}),jsEditor.on("change",function(){updatePreview()})}if(-1===url.indexOf("edit")){var htmlEditor=CodeMirror(document.getElementById("htmlEditor"),{mode:"text/html",tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,foldGutter:!0,readOnly:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],value:""}),cssEditor=CodeMirror(document.getElementById("cssEditor"),{mode:"text/css",tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,foldGutter:!0,readOnly:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}),jsEditor=CodeMirror(document.getElementById("jsEditor"),{tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,foldGutter:!0,dragDrop:!0,readOnly:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],mode:{name:"javascript",globalVars:!1}}),mdEditor=CodeMirror(document.getElementById("mdEditor"),{mode:"text/x-markdown",theme:"default",tabMode:"indent",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseTags:!0,readOnly:!0,gutters:["CodeMirror-linenumbers"]});htmlEditor.on("change",function(){updatePreview()}),cssEditor.on("change",function(){cssPreProcessor(),$("#preview").contents().find("#b8c770cc").html(cssContent),setTimeout(function(){cssEditor.setOption("paletteHints","true")},300)}),jsEditor.on("change",function(){updatePreview()})}url.indexOf("dark")>-1&&(mdEditor.setOption("theme","kwdark"),htmlEditor.setOption("theme","kwdark"),cssEditor.setOption("theme","kwdark"),jsEditor.setOption("theme","kwdark"),$("header").css("background","#2c323b"),$("header a").css("color","#a3b7c7")),url.indexOf("transparent")>-1&&$(".CodeMirror, .CodeMirror *").css("background","transparent!important"),-1===url.indexOf("transparent")&&$(".editor, .result").css("z-index","1"),url.indexOf("norerun")>-1&&$(".rerun").remove(),setTimeout(function(){$("[data-target=mdEditor]").hasClass("hide")&&$("#mdEditor").remove(),$("[data-target=htmlEditor]").hasClass("hide")&&$("#htmlEditor").remove(),$("[data-target=cssEditor]").hasClass("hide")&&$("#cssEditor").remove(),$("[data-target=jsEditor]").hasClass("hide")&&$("#jsEditor").remove(),$("[data-target=preview]").hasClass("hide")&&$("#preview").remove()},300),setTimeout(function(){$(".mainmenu .hide").remove(),$(".mainmenu a:not(.hide):first").trigger("click")},500)}else window.location.href="https://mikethedj4.github.io/kodeWeave/embed/"+url+"?md,html,css,js,result";$(".mainmenu a").on("click",function(e){if($(".selected").is(":visible")&&$(".mainmenu a").removeClass("selected"),$(window).width()<=617)$(this).addClass("selected"),$("#mdEditor").addClass("hide"),$("#htmlEditor").addClass("hide"),$("#cssEditor").addClass("hide"),$("#jsEditor").addClass("hide"),url.indexOf("?")>-1&&(url.indexOf("transparent")>-1||$("#preview").addClass("hide")),$("#"+$(this).attr("data-target")).removeClass("hide");else{if("preview"===$(this).attr("data-target").toLowerCase())return!1;$(this).addClass("selected"),$("#mdEditor").addClass("hide"),$("#htmlEditor").addClass("hide"),$("#cssEditor").addClass("hide"),$("#jsEditor").addClass("hide"),$("#"+$(this).attr("data-target")).removeClass("hide")}return mdEditor.refresh(),htmlEditor.refresh(),cssEditor.refresh(),jsEditor.refresh(),setTimeout(function(){return mdEditor.setOption("paletteHints","true"),htmlEditor.setOption("paletteHints","true"),cssEditor.setOption("paletteHints","true"),jsEditor.setOption("paletteHints","true"),!1},300),!1}),$(window).on("load resize",function(){!0===previeweditor.checked&&(mdeditor.checked||htmleditor.checked||csseditor.checked||jseditor.checked?($(this).width()<=617?($(".editor").css("width","100%"),$(".preview-editor").css("left","0"),$("[data-target=preview]").show()):($(".editor").css("width","50%"),$(".preview-editor").css("left","50%"),$("[data-target=preview]").hasClass("selected")?($("[data-target=preview]").hide().removeClass("selected"),setTimeout(function(){$(".mainmenu a:not(.hide):first").trigger("click")})):($("[data-target=preview]").hide(),$("#preview").show())),$(this).width()<=420?$("[data-target=mdEditor]").text("MD"):$("[data-target=mdEditor]").text("Markdown")):($("header, .rerun").remove(),$(".editor").css("width","100%"),$("#editors, .preview-editor").css("top","0"),$("#editors").css("bottom","0"),$(".preview-editor").css("left","0"),$(".preview-editor").css("height","calc(100vh - 4px)"),$("[data-target=preview]").show()))});var myarray=[],current=1,download_to_textbox=function(e,t){return $.get(e,null,function(e){t.val(e)},"text")},download_to_editor=function(e,t){return $.get(e,null,function(e){t.setValue(e)},"text")},hash=window.location.hash.substring(1);$(document.body).append('<div class="fixedfill preloader" style="background: #fff;"></div>'),$(".preloader").html('<div class="table"><div class="cell"><img class="spin" src="assets/loading.svg"></div></div>'),loadgist(hash),updatePreview(),$(".logo").attr("href","https://mikethedj4.github.io/kodeWeave/editor/#"+hash.substring(0,hash.indexOf("?"))).attr("target","_blank"),$(".settings").on("click",function(){$(".preprocessor").addClass("hide"),$(this).hasClass("htmlSetting")?$(".html-preprocessor").removeClass("hide"):$(this).hasClass("cssSetting")?$(".css-preprocessor").removeClass("hide"):$(this).hasClass("jsSetting")&&$(".js-preprocessor").removeClass("hide"),"none"==$("#html-preprocessor").val()?htmlEditor.getValue||$(".html-preprocessor-convert").addClass("hide"):"jade"==$("#html-preprocessor").val()&&(htmlEditor.getValue||$(".html-preprocessor-convert").addClass("hide")),"none"==$("#js-preprocessor").val()?jsEditor.getValue||$(".js-preprocessor-convert").addClass("hide"):"coffeescript"==$("#js-preprocessor").val()&&(jsEditor.getValue||$(".js-preprocessor-convert").addClass("hide")),$("[data-action=preprocessors]").fadeIn()}),$("#html-preprocessor").on("change",function(){var e=this.value;"none"==e?(htmlEditor.setOption("mode","text/html"),htmlEditor.setOption("gutters",["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"])):"jade"==e?(htmlEditor.setOption("mode","text/x-jade"),htmlEditor.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"])):(htmlEditor.setOption("mode","text/html"),htmlEditor.setOption("gutters",["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"])),updatePreview()}).trigger("change"),$("#css-preprocessor").on("change",function(){var e=this.value;"none"==e?(cssEditor.setOption("mode","text/css"),cssEditor.setOption("gutters",["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"])):"stylus"==e?(cssEditor.setOption("mode","text/x-styl"),cssEditor.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"])):"less"==e?(cssEditor.setOption("mode","text/x-less"),cssEditor.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"])):(cssEditor.setOption("mode","text/css"),cssEditor.setOption("gutters",["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"])),updatePreview()}).trigger("change"),$("#js-preprocessor").on("change",function(){var e=this.value;"none"==e?(jsEditor.setOption("mode","text/javascript"),$(".jsvalidator").show()):"coffeescript"==e?jsEditor.setOption("mode","text/x-coffeescript"):"typescript"==e?jsEditor.setOption("mode","text/typescript"):"babel"==e?jsEditor.setOption("mode","text/javascript"):($(".jsvalidator").show(),jsEditor.setOption("mode","text/javascript")),updatePreview()}).trigger("change");var textarea=document.querySelector("[data-action=library-code]");$("[data-action=check]").on("change keyup",function(){var e=$(this).parent().nextAll("div").children(".libsources:first").val()+"\n";!0===$(this).prop("checked")?textarea.value=textarea.value+e:textarea.value=textarea.value.replace(e,"");for(var t=$("[type=checkbox].check:checked"),r=[],s=0,o=t.length;s<o;s++)r.push($(t[s]).attr("id"))}),$("#jquery").trigger("keyup")}else $(document.body).append('<div class="fixedfill preloader"></div>'),$(".preloader").html('<div class="table"><div class="cell"><h1>No weave detected!</h1><a class="launcheditor" href="../editor" target="_blank">Launch Editor!</a></div></div><style>.launcheditor {\n  position: relative;\n  background: #4e92a2;\n  color: #fff;\n  padding: 1em 2em;\n  font-size: 14px;\n  top: 15px;\n}\n\n.launcheditor:hover {\n  background: #57b5cc;\n}\n\n.launcheditor:active {\n  background: #407c8a;\n}</style>');